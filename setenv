#! /bin/bash

WORKSPACE=$(dirname $(readlink -f ${0}))

# point to workspace GCC
export PATH="$WORKSPACE/env/gcc/bin:$PATH"
export LD_LIBRARY_PATH="$WORKSPACE/env/gcc/lib:$LD_LIBRARY_PATH"

# point to workspace CMake
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    export PATH="$PATH:$WORKSPACE/env/cmake/bin"
elif [[ "$OSTYPE" == "darwing"* ]]; then
    export PATH="$PATH:$WORKSPACE/env/cmake/CMake.app/Contents/bin"
fi

# point to workspace Python3
export PATH="$WORKSPACE/env/python/bin:$PATH"
export LD_LIBRARY_PATH="$WORKSPACE/env/python/lib:$LD_LIBRARY_PATH"

# point to workspace ninja
export PATH="$WORKSPACE/env/ninja/bin:$PATH"

if [[ -z $(ls -A "${WORKSPACE}/.venv/") ]]; then
    echo "WARNING: No python virtual environment has been detected."
    echo "Local workspace packages may not be detected by the python interpreter"
else
    echo "Activating virtual python environment"
    source "${WORKSPACE}/.venv/bin/activate"
    pip3 install -r requirements.txt
fi